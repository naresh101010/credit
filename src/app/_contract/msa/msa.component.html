<form name="msaForm" (ngSubmit)="msaForm.form.valid " #msaForm="ngForm" class="retailContainer">

<div class="hero-content">
  <div class="row text-left parent">      
        <div class="breadcrumb">
          <a routerLink="/retail-contract/retail" target="_self">Dashboard</a><span class="fa fa-caret-right"></span>
          <a routerLink="/retail-contract/retail" target="_self">Contracts</a><span class="fa fa-caret-right"></span>
          <a routerLink="/retail-contract/retail" target="_self">Customer</a><span class="fa fa-caret-right"></span>
          CREDIT
      </div>
      <stepper></stepper>
    </div>
  <h3>Credit Contract</h3>
  <div id="mat-card-heading" fxLayout="row"  *ngFor="let user of msa.responseData" fxLayout.xs="column" fxLayoutAlign="space-between center" fxLayoutAlign.xs="space-between start" class="mat-card-header-container">
      <div fxFlex=33 fxFlex.xs=100 fxLayout="row" fxLayoutAlign="start"><span>Customer Name : </span><span>{{user.custName}}</span></div>
      <div fxFlex=33 fxFlex.xs=100 fxLayout="row" fxLayoutAlign="start"><span>Salesforce Account Id : </span><span>{{user.sfdcAccId}}</span></div>
      <div fxFlex=33 fxFlex.xs=100 fxLayout="row" fxLayoutAlign="start"><span>SFX Code : </span><em>NOT GENERATED YET</em></div>
    </div> 
    <mat-card>
      <!-- sfx -->
      <div *ngIf="msa.responseData">
      <!-- <div> -->
        <div class="row"   *ngFor="let user of msa.responseData">
          <div class="col-lg-4 col-md-4 col-sm-4 col-xl-4">						
            <div class="row">
              <div class="col-lg-6 col-md-6 label-text">PAN No.</div>
              <div class="col-lg-6 col-md-6 label-text-value" >              
                {{user.pan}} </div>
            </div>
            <div class="row">
              <div class="col-lg-6 col-md-6 label-text">Contact Person</div>
              <div class="col-lg-6 col-md-6 label-text-value" >
                {{user.contactPerson}}</div>
            </div> 
                     
            <div class="row">
              <div class="col-lg-6 col-md-6 label-text">Contact No. (L)</div>
              <div class="col-lg-6 col-md-6 label-text-value mNo"> {{ user.phone }}</div>
            </div>
            <div class="row">
              <div class="col-lg-6 col-md-6 label-text">Contact No. (M)</div>
              <div class="col-lg-6 col-md-6 label-text-value mNo" >
                {{user.mobile}}</div>
            </div> 
            <div class="row">
              <div class="col-lg-6 col-md-6 label-text">GSTIN</div>
              <div class="col-lg-6 col-md-6 label-text-value"  > {{user.gstinNum}} </div>
            </div>
            <div class="row">
              <div class="col-lg-6 col-md-6 label-text">Group Code</div>
              <div class="col-lg-6 col-md-6 label-text-value">{{user.groupCode}}  </div>
            </div>
            <div class="row">
              <div class="col-lg-6 col-md-6 label-text">Customer Segment</div>
              <div class="col-lg-6 col-md-6 label-text-value">{{user.segment}}  
              </div>
            </div>
            <div class="row">
              <div class="col-lg-6 col-md-6 label-text">Customer Sub-segment</div>
              <div class="col-lg-6 col-md-6 label-text-value">{{ user.subsegment }}  </div>
            </div>
            <div class="row">
              <div class="col-lg-6 col-md-6 label-text">Registered Address</div>
              <div class="col-lg-6 col-md-6 label-text-value" *ngFor="let cnee of user.msaCustAddrs">{{cnee.addr}}  </div>
            </div>
            <div class="row">
                <div class="col-lg-6 col-md-6 label-text">Base Location<span style="color: red;"> *</span></div>              
                <div class="col-lg-6 col-md-6 col-sm-6">
               <ng-select [items]="tableData" id="baseLoacation"
                   name="baseLocation"
                   bindLabel="baseLocation"
                   [virtualScroll]="true"
                   bindValue="baseLocationBranchId"
                   appendTo="body"
                   (search) ='advanceDefaultBranchName($event)'
                   [(ngModel)]="user.baseLocationBranchId"
                   required #baseLocation="ngModel">
              </ng-select>




                </div>
                <app-validation-msg *ngIf="(baseLocation.errors?.required && baseLocation.touched)" [msg]="'Required !'"></app-validation-msg>
         
              </div>
            
          </div>
          <div class="col-lg-3 col-md-3 col-sm-3 col-xl-3"></div>
          <div class="col-lg-5 col-md-5 col-sm-5 col-xl-5">          
            <div class="col-lg-6 col-md-6"></div>
            <div class="col-lg-6 col-md-6"></div>
            <div class="row">
              <div class="col-lg-7 col-md-7 col-xs-7 col-sm-7 label-text">Salesforce Monthly Potential (Air)</div>
              <div class="col-lg-5 col-md-5 col-sm-5 col-xs-5 label-text-value">{{user.sfdcMnthPotentialAir}} </div>
            </div>
            <div class="row">
              <div class="col-lg-7 col-md-7 col-xs-7 col-sm-7 label-text">Salesforce Monthly Potential (Surface)</div>
              <div class="col-lg-5 col-md-5 col-sm-5 col-xs-5 label-text-value">{{user.sfdcMnthPotentialSurface}}  </div>
            </div>
            <div class="row">
              <div class="col-lg-7 col-md-7 col-xs-7 col-sm-7 label-text">Salesforce Monthly Potential (3PL)</div>
              <div class="col-lg-5 col-md-5 col-sm-5 col-xs-5 label-text-value"> {{user.sfdcMnthPotential3pl}}
                 </div>
            </div>
            <div class="row">
              <div class="col-lg-7 col-md-7 col-xs-7 col-sm-7 label-text">Account Type</div>
              <div class="col-lg-5 col-md-5 col-sm-5 col-xs-5 label-text-value">
                  {{user.accType}}
              </div>
            </div>
            <div class="row">
              <div class="col-lg-7 col-md-7 col-xs-7 col-sm-7 label-text">Monthly Potential</div>
              <div class="col-lg-5 col-md-5 col-sm-5 col-xs-5 label-text-value">{{user.mnthPotential}}  </div>
            </div>
            <div class="row">
              <div class="col-lg-7 col-md-7 col-xs-7 col-sm-7 label-text">Credit Risk</div>
              <div class="col-lg-5 col-md-5 col-sm-5 col-xs-5 label-text-value">{{user.creditRisk}}  </div>
            </div>
            <div class="row">
              <div class="col-lg-7 col-md-7 col-xs-7 col-sm-7 label-text">SLA (%)<span style="color: red;"> *</span></div>
              <div class="col-lg-5 col-md-5 col-sm-5 col-xs-5 label-text-value">
                  <div class="form-group">
                      <input id="inputtext" type ="text" required #sla1='ngModel' numeric decimals="2"  class="inputBox form-control input-field padding-left"  name="sla"  [(ngModel)]="user.sla" maxlength="4">                 
                      </div>
                 
                        <app-validation-msg *ngIf="(sla1.errors?.required && sla1.touched)" [msg]="'Required !'"></app-validation-msg>
                  </div>
            </div>
          </div>
        </div>
  
  </div>
      <mat-accordion id="shadow" *ngIf="msa.responseData">
        <mat-expansion-panel id="box-shadow">
          <mat-expansion-panel-header>Consignor & Consignee Details                         
                 <mat-icon id="plusicon"  (click)="openDialog()" mat-card-avatar aria-label="Example icon">add_circle</mat-icon>
              <a id="exelLink" (click)="ExportTOExcel()" style="cursor: pointer;">Export Consignor/Consignee |</a>
              <a id="exelLink1" style="cursor: pointer;" (click)="openDialogForDownloadError()">View Uploaded Files |</a>
              <a id="exelLink1" style="cursor: pointer;" (click)="downloadTemplate()">Download Template |</a>
              <input type="file" #browseFile id="file" (change)="handleFileInput($event)" style="display:none">
              <a (click)="browseFile.click()">Bulk Upload</a>&nbsp;{{uploadedBFileName}}
          </mat-expansion-panel-header>
    <div class="example-container mat-elevation-z8" #TABLE style="margin-top: 1rem;">  
    <button class="btn1" style="text-align: left;" mat-raised-button color="primary" (click)="deactivateCneeCor()" style="margin-bottom: 1rem;">Delete</button>
     <table  mat-table  [dataSource]="dataSource" matSort  aria-describedby="table" >
  
      <ng-container matColumnDef="name">
        <th scope="row" mat-header-cell *matHeaderCellDef mat-sort-header>
          <mat-checkbox [checked]="selFlag" (change)="selectAll($event)" color="primary">
            <span class="service-fonts-checkbox">NAME</span>
          </mat-checkbox>
        </th>
        <td mat-cell  *matCellDef="let element; let j = index;">
         <mat-checkbox [checked]="selFlag" color="primary" (change)="prepareDeactivateUsersList($event,element)">
            <span class="service-fonts-checkbox">{{element.name | uppercase}}</span>
         </mat-checkbox>
        </td>
      </ng-container>
      <ng-container matColumnDef="lkpConsigntypeId">
        <th scope="row" mat-header-cell *matHeaderCellDef mat-sort-header>TYPE </th>
        <td mat-cell *matCellDef="let element"> {{element.lkpConsigntypeId | uppercase}} </td>
      </ng-container>
      <ng-container matColumnDef="panNum">
        <th scope="row" mat-header-cell *matHeaderCellDef mat-sort-header> PAN NO.</th >
        <td mat-cell *matCellDef="let element"> {{element.panNum | uppercase}} </td>
      </ng-container>
      <ng-container matColumnDef="gstinNum">
        <th scope="row" mat-header-cell *matHeaderCellDef mat-sort-header> GST NO. </th>
        <td mat-cell *matCellDef="let element"> {{element.gstinNum | uppercase}} </td>
      </ng-container>
      <ng-container matColumnDef="tanNum">
        <th scope="row" mat-header-cell *matHeaderCellDef mat-sort-header> TAN NO. </th>
        <td mat-cell *matCellDef="let element"> {{element.tanNum | uppercase}} </td >
      </ng-container>
      <ng-container matColumnDef="mob">
        <th scope="row" mat-header-cell *matHeaderCellDef  mat-sort-header> MOBILE NO. </th >
        <td mat-cell *matCellDef="let element"> {{element.mob | uppercase}} </td>
      </ng-container>
      <ng-container matColumnDef="addr1">
        <th scope="row" mat-header-cell *matHeaderCellDef mat-sort-header> ADDRESS </th >
        <td mat-cell *matCellDef="let element" > {{element.addrBook.addr1+element.addrBook.addr2+element.addrBook.addr3 | uppercase }} </td>
      </ng-container>
      <ng-container matColumnDef="city">
        <th scope="row" mat-header-cell *matHeaderCellDef mat-sort-header> CITY </th >
        <td mat-cell *matCellDef="let element"> {{element.city | uppercase}} </td>
      </ng-container>
      <ng-container matColumnDef="pincode">
        <th scope="row" mat-header-cell *matHeaderCellDef mat-sort-header>PINCODE  </th>
        <td mat-cell *matCellDef="let element"> {{element.pincode | uppercase}} </td>
      </ng-container>
      <ng-container matColumnDef="dealerCode">
        <th scope="row" mat-header-cell *matHeaderCellDef mat-sort-header>DEALER CODE  </th>
        <td mat-cell *matCellDef="let element"> {{element.dealerCode | uppercase}} </td>
      </ng-container>
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
       <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table >
  </div>  
  
  

  
  
    
  
  
        </mat-expansion-panel>
          </mat-accordion>       
      <div style="margin-top: 3%;">
        <mat-accordion>       
          <div class="example-button-row text-center" style="margin-top: 5%">
            <button class="btn1" id="secondry-button" mat-raised-button color="primary" [disabled]='!msaForm.form.valid'  (click)="putMsa()">Save As Draft</button> 
            <button class="btn1" style="text-align: center" mat-raised-button color="primary" [disabled]='!msaForm.form.valid' (click)="msaNext()">Next</button>
            </div>
        </mat-accordion>
      </div>
  
    </mat-card>
  </div>


</form>


<ngx-spinner id="spinner" size="large" type="ball-spin-clockwise">  

</ngx-spinner>
