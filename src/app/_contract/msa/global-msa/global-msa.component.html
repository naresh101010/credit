<div class="hero-content retailContainer">
  <div class="row text-left parent">
    <div class="breadcrumb">
      <a routerLink="/retail-contract/retail" target="_self">Dashboard</a><span class="fa fa-caret-right"></span>
      <a routerLink="/retail-contract/retail" target="_self">Contracts</a><span class="fa fa-caret-right"></span>
      <a routerLink="/retail-contract/retail" target="_self">Customer</a><span class="fa fa-caret-right"></span>
      RETAIL
    </div>
    <stepper></stepper>
  </div>
  <h3>Retail Contract</h3>
  <div id="mat-card-heading" fxLayout="row" style="height: 25px;" fxLayout.xs="column"
    fxLayoutAlign="space-between center" fxLayoutAlign.xs="space-between start" class="mat-card-header-container">
  </div>
  <mat-card>
    <mat-card-content>
      <form [formGroup]="msaForm">
        <div class="row margintop10">
          <div class="col-lg-5 col-md-6 col-sm-6 col-xl-6">
            <div class="row">
              <div class="col-lg-4 col-md-5 label-text">MSA Level<span class="redMark"> *</span></div>
              <div class="col-lg-4 col-md-4 label-text-value">
                <mat-form-field appearance="outline">
                  <mat-select panelClass="creditSelect" formControlName="custLevel" (selectionChange)="onSelectMSALevel($event.value)">
                    <mat-option *ngFor="let m of securityTypeList" [value]="m.lookupVal">
                      {{m.lookupVal}}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
                <div *ngIf="(f.custLevel.errors?.required && f.custLevel.touched)" class="redMark">Required !</div>
              </div>
            </div>
            <div class="row" *ngIf="f.custLevel.value !=='MSA CLUSTER'">
              <div class="col-lg-4 col-md-5 label-text">MSA Name<span class="redMark"> *</span></div>
              <div class="col-lg-4 col-md-4 label-text-value">
                <mat-form-field appearance="outline">
                  <input matInput name="msaName" autocomplete="true" formControlName="custName" maxlength="25">
                </mat-form-field>
                <div *ngIf="(f.custName.errors?.required && f.custName.touched)" class="redMark">Required !</div>
              </div>
            </div>
            <div class="row" *ngIf="f.custLevel.value ==='MSA CLUSTER' && f.custLevel.value !==''">
              <div class="col-lg-4 col-md-5 label-text">Cluster Name<span class="redMark"> *</span></div>
              <div class="col-lg-4 col-md-4 label-text-value">
                <mat-form-field appearance="outline">
                  <input matInput name="clusterName" autocomplete="true" formControlName="custName" maxlength="25">
                </mat-form-field>
                <div *ngIf="(f.custName.errors?.required && f.custName.touched)" class="redMark">Required !</div>
              </div>
            </div>
          </div>
          <div class="col-lg-2 col-md-6 col-sm-6 col-xl-6"></div>
          <div class="col-lg-5 col-md-6 col-sm-6 col-xl-6">
            <div class="row">
              <div class="col-lg-4 col-md-5 label-text">SLA (%)</div>
              <div class="col-lg-4 col-md-4 label-text-value">
                <mat-form-field appearance="outline">
                  <input matInput name="SLA" numeric autocomplete="true" formControlName="sla" maxlength="3" pattern="^[0-9][0-9]*$">
                </mat-form-field>
                <div *ngIf="(f.sla.errors?.max && f.sla.touched ) || f.sla.invalid" class="redMark">Invalid Percentage !</div>
              </div>
            </div>
         
          </div>
        </div>
        <div class="row margintop10" *ngIf="f.custLevel.value ==='MSA CLUSTER' && f.custLevel.value !==''">
          <div class="col-lg-5 col-md-6 col-sm-6 col-xl-6">
            <div class="row">
              <div class="col-lg-4 col-md-5 label-text">Cluster Start Date<span class="redMark">*</span></div>
              <div class="col-lg-4 col-md-4 label-text-value">
                <mat-form-field appearance="outline">
                  <input matInput [matDatepicker]="pickerstart" formControlName="effectiveDt"
                  (dateChange)="effectiveDate()" (blur)="effectiveDate()"
                   class="date_picker">
                   <mat-datepicker panelClass="creditDatepicker" #pickerstart></mat-datepicker>
                  <mat-datepicker-toggle matSuffix [for]="pickerstart"></mat-datepicker-toggle>                  
                </mat-form-field>
                <!-- validation -->
                <div *ngIf="(f.effectiveDt.errors?.required && f.effectiveDt.touched)" class="redMark">Required !</div>
                <div *ngIf="isValidEffectiveDt && !(f.effectiveDt.errors?.required)" class="redMark">
                 Invalid Start Date!
                </div>
               <!-- validation -->
              </div>
            </div>
          </div>          
          <div class="col-lg-2 col-md-6 col-sm-6 col-xl-6"></div>
          <div class="col-lg-5 col-md-6 col-sm-6 col-xl-6">
            <div class="row">
              <div class="col-lg-4 col-md-5 label-text">Cluster End Date<span class="redMark">*</span></div>
              <div class="col-lg-4 col-md-4 label-text-value">
                <mat-form-field appearance="outline">
                  <input matInput [matDatepicker]="pickerend" formControlName="expDt"
                  (dateChange)="expDate()" (blur)="expDate()"
                  [min]="minDate" class="date_picker">
                  <mat-datepicker-toggle matSuffix [for]="pickerend"></mat-datepicker-toggle>
                  <mat-datepicker panelClass="creditDatepicker" #pickerend></mat-datepicker>
                </mat-form-field>
                <div *ngIf="(f.expDt.errors?.required && f.expDt.touched)" class="redMark">Required !</div>
                <div *ngIf="isValidExpDt && !(f.expDt.errors?.required)" class="redMark">
                  Invalid End Date!
                </div>
              </div>
            </div>
          </div>

        </div>

        <div class="row" style="margin-top: 35px;" *ngxPermissionsOnly="['NOTEPAD_CREATE']">
          <div class="col-lg-4">
            <h5 class="zonalheading">Notepad Section</h5>
          </div>
        </div>
        <div class="row margintop10" *ngxPermissionsOnly="['NOTEPAD_CREATE']">
          <div class="col-md-5">
            <div class="table-responsive">
            <table>
              <thead>
                <tr style="margin-bottom: 20px;">
                  <th scope="row" class="table-heading label-text">Field label</th>
                  <th scope="row" class="table-heading label-text">Field Value</th>
                </tr>
              </thead>
              <tbody>
                <tr formArrayName="notepadTrans" *ngFor="let notepadCntl of msaNotepadArray.controls | sort:'notepadId'; let i=index">
                  <td [formGroupName]="i">
                    <div class="label-text">
                      {{(getFieldLabelAndValue(notepadCntl.controls.notepadId.value))?.notepadName}}
                    </div>
                  </td>
                  <td [formGroupName]="i">
                    <div *ngIf="(getFieldLabelAndValue(notepadCntl.controls.notepadId.value))?.attributeTypeId === 1">
                      <mat-radio-group aria-label="Select an option" formControlName="notepadInputVal">
                        <mat-radio-button
                          *ngFor="let item of convertStringToArray((getFieldLabelAndValue(notepadCntl.controls.notepadId.value))?.attributeValue)"
                          [value]="item" class="mr10">{{item}}</mat-radio-button>
                      </mat-radio-group>
                    </div>
                    <div *ngIf="(getFieldLabelAndValue(notepadCntl.controls.notepadId.value))?.attributeTypeId === 3"  style="width: 60%;">
                      <mat-form-field appearance="outline">
                        <input matInput name="msaName" autocomplete="true" maxlength="15" formControlName="notepadInputVal" [value]="(notepadCntl.controls.notepadInputVal.value === undefined || notepadCntl.controls.notepadInputVal.value) == '' ?
                        ((getFieldLabelAndValue(notepadCntl.controls.notepadId.value))?.attributeValue === undefined ? '' : (getFieldLabelAndValue(notepadCntl.controls.notepadId.value))?.attributeValue) : notepadCntl.controls.notepadInputVal.value">
                      </mat-form-field>
                    </div>
                    <div *ngIf="(getFieldLabelAndValue(notepadCntl.controls.notepadId.value))?.attributeTypeId === 2" style="width: 60%;"> 
                      <mat-form-field appearance="outline">
                        <mat-select panelClass="creditSelect" formControlName="notepadInputVal">
                          <mat-option
                            *ngFor="let option of convertStringToArray((getFieldLabelAndValue(notepadCntl.controls.notepadId.value))?.attributeValue)"
                            [value]="option">
                            {{option}}
                          </mat-option>
                        </mat-select>
                      </mat-form-field>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          </div>
        </div>

        <div style="margin-top: 3%;">
          <div class="example-button-row text-center" style="margin-top: 5%" *ngxPermissionsOnly="['MSA_CREATE','MSA_UPDATE']">
            <button *ngIf="!editflow" class="btn1" id="secondry-button" mat-raised-button color="primary" (click)="saveMSA(0, $event)" [disabled]="editflow ? 'false' :!msaForm.valid || isSaved || isValidEffectiveDt || isValidExpDt">Save As
              Draft</button>
              <button class="btn1"
                mat-raised-button color="primary" (click)="saveMSA(1, $event)" [disabled]="editflow ? 'false' :!msaForm.valid || isSaved || isValidEffectiveDt || isValidExpDt">Next
              </button>
          </div>
        </div>
      </form>
    </mat-card-content>
  </mat-card>
</div>
<ngx-spinner id="spinner" size="large" type="ball-spin-clockwise">
</ngx-spinner>